syntax = "proto3";

package proto;
option go_package = "proto";

import "google/api/annotations.proto";
import "protoc-gen-swagger/options/annotations.proto";

option (grpc.gateway.protoc_gen_swagger.options.openapiv2_swagger) = {
  info: {
    title: "Settings";
    version: "1.0";
    contact: {
      name: "ownCloud GmbH";
      url: "https://github.com/owncloud/ocis-settings";
      email: "support@owncloud.com";
    };
    license: {
      name: "Apache-2.0";
      url: "https://github.com/owncloud/ocis-settings/blob/master/LICENSE";
    };
  };
  schemes: HTTP;
  schemes: HTTPS;
  consumes: "application/json";
  produces: "application/json";
  external_docs: {
    description: "Developer Manual";
    url: "http://owncloud.github.io/extensions/ocis_settings/";
  };
};

service BundleService {
  rpc CreateSettingsBundle(CreateSettingsBundleRequest) returns (CreateSettingsBundleResponse) {
    option (google.api.http) = {
      post: "/api/v0/bundles",
      body: "*"
    };
  };
  rpc GetSettingsBundle(GetSettingsBundleRequest) returns (GetSettingsBundleResponse) {
    option (google.api.http) = {
      get: "/api/v0/bundles/{extension}/{key}"
    };
  };
  rpc ListSettingsBundles(ListSettingsBundlesRequest) returns (ListSettingsBundlesResponse) {
    option (google.api.http) = {
      get: "/api/v0/bundles"
    };
  };
}

// requests and responses
message CreateSettingsBundleRequest {
  SettingsBundle settingsBundle = 1;
}

message CreateSettingsBundleResponse {
  SettingsBundle settingsBundle = 1;
}

message GetSettingsBundleRequest {
  string extension = 1;
  string key = 2;
}

message GetSettingsBundleResponse {
  SettingsBundle settingsBundle = 1;
}

message ListSettingsBundlesRequest {
  string extension = 1;// can be limited to all settings bundles of an extension
}

message ListSettingsBundlesResponse {
  repeated SettingsBundle settingsBundles = 1;
}

// payloads
message SettingsBundle {
  string extension = 1;
  string key = 2;
  string displayName = 3;
  repeated Setting settings = 4;
}

message Setting {
  string key = 1;
  string displayName = 2;
  string description = 3;
  oneof value {
    IntSetting intValue = 4;
    StringSetting stringValue = 5;
    BoolSetting boolValue = 6;
    SingleChoiceListSetting singleChoiceValue = 7;
    MultiChoiceListSetting multiChoiceValue = 8;
  }
}

message IntSetting {
  int64 default = 1;
  int64 min = 2;
  int64 max = 3;
  int64 step = 4;
  string placeholder = 5;
}

message StringSetting {
  string default = 1;
  bool required = 2;
  int32 minLength = 3;
  int32 maxLength = 4;
  string placeholder = 5;
}

message BoolSetting {
  bool default = 1;
}

message SingleChoiceListSetting {
  repeated ListOption options = 1;
}

message MultiChoiceListSetting {
  repeated ListOption options = 1;
}

message ListOption {
  oneof option {
    string stringValue = 1;
    int64 intValue = 2;
  }
  bool selected = 3;
  string displayValue = 4;
}
